{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":78,"index":78}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":79},"end":{"line":2,"column":69,"index":148}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}},{"name":"react/jsx-dev-runtime","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"L9D70Z4hi4aGuui1ysja/oQ5ytI=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _jsxFileName = \"/app/frontend/src/contexts/UserContext.tsx\";\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.UserProvider = UserProvider;\n  exports.useUser = useUser;\n  var _react = require(_dependencyMap[0], \"react\");\n  var _reactNativeAsyncStorageAsyncStorage = require(_dependencyMap[1], \"@react-native-async-storage/async-storage\");\n  var AsyncStorage = _interopDefault(_reactNativeAsyncStorageAsyncStorage);\n  var _reactJsxDevRuntime = require(_dependencyMap[2], \"react/jsx-dev-runtime\");\n  const API_URL = process.env.EXPO_PUBLIC_BACKEND_URL;\n  const UserContext = /*#__PURE__*/(0, _react.createContext)(undefined);\n  function UserProvider({\n    children\n  }) {\n    const [userId, setUserId] = (0, _react.useState)(null);\n    const [isPremium, setIsPremium] = (0, _react.useState)(false);\n    const [isLoading, setIsLoading] = (0, _react.useState)(true);\n    const [hasCompletedOnboarding, setHasCompletedOnboarding] = (0, _react.useState)(false);\n    (0, _react.useEffect)(() => {\n      initializeUser();\n    }, []);\n    const initializeUser = async () => {\n      try {\n        const storedUserId = await AsyncStorage.default.getItem('userId');\n        const onboardingComplete = await AsyncStorage.default.getItem('onboardingComplete');\n        const storedPremium = await AsyncStorage.default.getItem('isPremium');\n\n        // Set premium from local storage first\n        if (storedPremium === 'true') {\n          setIsPremium(true);\n        }\n        if (storedUserId) {\n          setUserId(storedUserId);\n          setHasCompletedOnboarding(onboardingComplete === 'true');\n          await refreshUser(storedUserId);\n        } else {\n          await createUser();\n        }\n      } catch (error) {\n        console.error('Failed to initialize user:', error);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    const createUser = async () => {\n      try {\n        const response = await fetch(`${API_URL}/api/users`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          }\n        });\n        const data = await response.json();\n        await AsyncStorage.default.setItem('userId', data.userId);\n        setUserId(data.userId);\n        setIsPremium(data.isPremium);\n      } catch (error) {\n        console.error('Failed to create user:', error);\n      }\n    };\n    const refreshUser = async id => {\n      const targetId = id || userId;\n      if (!targetId) return;\n      try {\n        const response = await fetch(`${API_URL}/api/users/${targetId}`);\n        const data = await response.json();\n        setIsPremium(data.isPremium || false);\n      } catch (error) {\n        console.error('Failed to refresh user:', error);\n      }\n    };\n    const completeOnboarding = async () => {\n      await AsyncStorage.default.setItem('onboardingComplete', 'true');\n      setHasCompletedOnboarding(true);\n    };\n    const setPremium = async premium => {\n      try {\n        // Update locally first for immediate UI feedback\n        console.log('Setting premium to:', premium);\n        setIsPremium(premium);\n        await AsyncStorage.default.setItem('isPremium', premium.toString());\n        console.log('Premium state updated successfully');\n\n        // Then update on server if userId exists\n        if (userId) {\n          const response = await fetch(`${API_URL}/api/users/${userId}/premium?is_premium=${premium}`, {\n            method: 'PATCH'\n          });\n          if (!response.ok) {\n            console.error('Server error updating premium');\n          }\n        }\n      } catch (error) {\n        console.error('Failed to update premium status:', error);\n        // Keep the local state even if server fails\n      }\n    };\n    return /*#__PURE__*/(0, _reactJsxDevRuntime.jsxDEV)(UserContext.Provider, {\n      value: {\n        userId,\n        isPremium,\n        isLoading,\n        hasCompletedOnboarding,\n        createUser,\n        completeOnboarding,\n        setPremium,\n        refreshUser\n      },\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 5\n    }, this);\n  }\n  function useUser() {\n    const context = (0, _react.useContext)(UserContext);\n    if (!context) {\n      throw new Error('useUser must be used within UserProvider');\n    }\n    return context;\n  }\n});","lineCount":132,"map":[[13,2,20,0,"exports"],[13,9,20,0],[13,10,20,0,"UserProvider"],[13,22,20,0],[13,25,20,0,"UserProvider"],[13,37,20,0],[14,2,131,0,"exports"],[14,9,131,0],[14,10,131,0,"useUser"],[14,17,131,0],[14,20,131,0,"useUser"],[14,27,131,0],[15,2,1,0],[15,6,1,0,"_react"],[15,12,1,0],[15,15,1,0,"require"],[15,22,1,0],[15,23,1,0,"_dependencyMap"],[15,37,1,0],[16,2,2,0],[16,6,2,0,"_reactNativeAsyncStorageAsyncStorage"],[16,42,2,0],[16,45,2,0,"require"],[16,52,2,0],[16,53,2,0,"_dependencyMap"],[16,67,2,0],[17,2,2,0],[17,6,2,0,"AsyncStorage"],[17,18,2,0],[17,21,2,0,"_interopDefault"],[17,36,2,0],[17,37,2,0,"_reactNativeAsyncStorageAsyncStorage"],[17,73,2,0],[18,2,2,69],[18,6,2,69,"_reactJsxDevRuntime"],[18,25,2,69],[18,28,2,69,"require"],[18,35,2,69],[18,36,2,69,"_dependencyMap"],[18,50,2,69],[19,2,5,0],[19,8,5,6,"API_URL"],[19,15,5,13],[19,18,5,16,"process"],[19,25,5,23],[19,26,5,24,"env"],[19,29,5,27],[19,30,5,28,"EXPO_PUBLIC_BACKEND_URL"],[19,53,5,51],[20,2,18,0],[20,8,18,6,"UserContext"],[20,19,18,17],[20,35,18,20],[20,39,18,20,"createContext"],[20,45,18,33],[20,46,18,33,"createContext"],[20,59,18,33],[20,61,18,63,"undefined"],[20,70,18,72],[20,71,18,73],[21,2,20,7],[21,11,20,16,"UserProvider"],[21,23,20,28,"UserProvider"],[21,24,20,29],[22,4,20,31,"children"],[23,2,20,71],[23,3,20,72],[23,5,20,74],[24,4,21,2],[24,10,21,8],[24,11,21,9,"userId"],[24,17,21,15],[24,19,21,17,"setUserId"],[24,28,21,26],[24,29,21,27],[24,32,21,30],[24,36,21,30,"useState"],[24,42,21,38],[24,43,21,38,"useState"],[24,51,21,38],[24,53,21,54],[24,57,21,58],[24,58,21,59],[25,4,22,2],[25,10,22,8],[25,11,22,9,"isPremium"],[25,20,22,18],[25,22,22,20,"setIsPremium"],[25,34,22,32],[25,35,22,33],[25,38,22,36],[25,42,22,36,"useState"],[25,48,22,44],[25,49,22,44,"useState"],[25,57,22,44],[25,59,22,45],[25,64,22,50],[25,65,22,51],[26,4,23,2],[26,10,23,8],[26,11,23,9,"isLoading"],[26,20,23,18],[26,22,23,20,"setIsLoading"],[26,34,23,32],[26,35,23,33],[26,38,23,36],[26,42,23,36,"useState"],[26,48,23,44],[26,49,23,44,"useState"],[26,57,23,44],[26,59,23,45],[26,63,23,49],[26,64,23,50],[27,4,24,2],[27,10,24,8],[27,11,24,9,"hasCompletedOnboarding"],[27,33,24,31],[27,35,24,33,"setHasCompletedOnboarding"],[27,60,24,58],[27,61,24,59],[27,64,24,62],[27,68,24,62,"useState"],[27,74,24,70],[27,75,24,70,"useState"],[27,83,24,70],[27,85,24,71],[27,90,24,76],[27,91,24,77],[28,4,26,2],[28,8,26,2,"useEffect"],[28,14,26,11],[28,15,26,11,"useEffect"],[28,24,26,11],[28,26,26,12],[28,32,26,18],[29,6,27,4,"initializeUser"],[29,20,27,18],[29,21,27,19],[29,22,27,20],[30,4,28,2],[30,5,28,3],[30,7,28,5],[30,9,28,7],[30,10,28,8],[31,4,30,2],[31,10,30,8,"initializeUser"],[31,24,30,22],[31,27,30,25],[31,33,30,25,"initializeUser"],[31,34,30,25],[31,39,30,37],[32,6,31,4],[32,10,31,8],[33,8,32,6],[33,14,32,12,"storedUserId"],[33,26,32,24],[33,29,32,27],[33,35,32,33,"AsyncStorage"],[33,47,32,45],[33,48,32,45,"default"],[33,55,32,45],[33,56,32,46,"getItem"],[33,63,32,53],[33,64,32,54],[33,72,32,62],[33,73,32,63],[34,8,33,6],[34,14,33,12,"onboardingComplete"],[34,32,33,30],[34,35,33,33],[34,41,33,39,"AsyncStorage"],[34,53,33,51],[34,54,33,51,"default"],[34,61,33,51],[34,62,33,52,"getItem"],[34,69,33,59],[34,70,33,60],[34,90,33,80],[34,91,33,81],[35,8,34,6],[35,14,34,12,"storedPremium"],[35,27,34,25],[35,30,34,28],[35,36,34,34,"AsyncStorage"],[35,48,34,46],[35,49,34,46,"default"],[35,56,34,46],[35,57,34,47,"getItem"],[35,64,34,54],[35,65,34,55],[35,76,34,66],[35,77,34,67],[37,8,36,6],[38,8,37,6],[38,12,37,10,"storedPremium"],[38,25,37,23],[38,30,37,28],[38,36,37,34],[38,38,37,36],[39,10,38,8,"setIsPremium"],[39,22,38,20],[39,23,38,21],[39,27,38,25],[39,28,38,26],[40,8,39,6],[41,8,41,6],[41,12,41,10,"storedUserId"],[41,24,41,22],[41,26,41,24],[42,10,42,8,"setUserId"],[42,19,42,17],[42,20,42,18,"storedUserId"],[42,32,42,30],[42,33,42,31],[43,10,43,8,"setHasCompletedOnboarding"],[43,35,43,33],[43,36,43,34,"onboardingComplete"],[43,54,43,52],[43,59,43,57],[43,65,43,63],[43,66,43,64],[44,10,44,8],[44,16,44,14,"refreshUser"],[44,27,44,25],[44,28,44,26,"storedUserId"],[44,40,44,38],[44,41,44,39],[45,8,45,6],[45,9,45,7],[45,15,45,13],[46,10,46,8],[46,16,46,14,"createUser"],[46,26,46,24],[46,27,46,25],[46,28,46,26],[47,8,47,6],[48,6,48,4],[48,7,48,5],[48,8,48,6],[48,15,48,13,"error"],[48,20,48,18],[48,22,48,20],[49,8,49,6,"console"],[49,15,49,13],[49,16,49,14,"error"],[49,21,49,19],[49,22,49,20],[49,50,49,48],[49,52,49,50,"error"],[49,57,49,55],[49,58,49,56],[50,6,50,4],[50,7,50,5],[50,16,50,14],[51,8,51,6,"setIsLoading"],[51,20,51,18],[51,21,51,19],[51,26,51,24],[51,27,51,25],[52,6,52,4],[53,4,53,2],[53,5,53,3],[54,4,55,2],[54,10,55,8,"createUser"],[54,20,55,18],[54,23,55,21],[54,29,55,21,"createUser"],[54,30,55,21],[54,35,55,33],[55,6,56,4],[55,10,56,8],[56,8,57,6],[56,14,57,12,"response"],[56,22,57,20],[56,25,57,23],[56,31,57,29,"fetch"],[56,36,57,34],[56,37,57,35],[56,40,57,38,"API_URL"],[56,47,57,45],[56,59,57,57],[56,61,57,59],[57,10,58,8,"method"],[57,16,58,14],[57,18,58,16],[57,24,58,22],[58,10,59,8,"headers"],[58,17,59,15],[58,19,59,17],[59,12,59,19],[59,26,59,33],[59,28,59,35],[60,10,59,54],[61,8,60,6],[61,9,60,7],[61,10,60,8],[62,8,62,6],[62,14,62,12,"data"],[62,18,62,16],[62,21,62,19],[62,27,62,25,"response"],[62,35,62,33],[62,36,62,34,"json"],[62,40,62,38],[62,41,62,39],[62,42,62,40],[63,8,63,6],[63,14,63,12,"AsyncStorage"],[63,26,63,24],[63,27,63,24,"default"],[63,34,63,24],[63,35,63,25,"setItem"],[63,42,63,32],[63,43,63,33],[63,51,63,41],[63,53,63,43,"data"],[63,57,63,47],[63,58,63,48,"userId"],[63,64,63,54],[63,65,63,55],[64,8,64,6,"setUserId"],[64,17,64,15],[64,18,64,16,"data"],[64,22,64,20],[64,23,64,21,"userId"],[64,29,64,27],[64,30,64,28],[65,8,65,6,"setIsPremium"],[65,20,65,18],[65,21,65,19,"data"],[65,25,65,23],[65,26,65,24,"isPremium"],[65,35,65,33],[65,36,65,34],[66,6,66,4],[66,7,66,5],[66,8,66,6],[66,15,66,13,"error"],[66,20,66,18],[66,22,66,20],[67,8,67,6,"console"],[67,15,67,13],[67,16,67,14,"error"],[67,21,67,19],[67,22,67,20],[67,46,67,44],[67,48,67,46,"error"],[67,53,67,51],[67,54,67,52],[68,6,68,4],[69,4,69,2],[69,5,69,3],[70,4,71,2],[70,10,71,8,"refreshUser"],[70,21,71,19],[70,24,71,22],[70,30,71,29,"id"],[70,32,71,40],[70,36,71,45],[71,6,72,4],[71,12,72,10,"targetId"],[71,20,72,18],[71,23,72,21,"id"],[71,25,72,23],[71,29,72,27,"userId"],[71,35,72,33],[72,6,73,4],[72,10,73,8],[72,11,73,9,"targetId"],[72,19,73,17],[72,21,73,19],[73,6,75,4],[73,10,75,8],[74,8,76,6],[74,14,76,12,"response"],[74,22,76,20],[74,25,76,23],[74,31,76,29,"fetch"],[74,36,76,34],[74,37,76,35],[74,40,76,38,"API_URL"],[74,47,76,45],[74,61,76,59,"targetId"],[74,69,76,67],[74,71,76,69],[74,72,76,70],[75,8,77,6],[75,14,77,12,"data"],[75,18,77,16],[75,21,77,19],[75,27,77,25,"response"],[75,35,77,33],[75,36,77,34,"json"],[75,40,77,38],[75,41,77,39],[75,42,77,40],[76,8,78,6,"setIsPremium"],[76,20,78,18],[76,21,78,19,"data"],[76,25,78,23],[76,26,78,24,"isPremium"],[76,35,78,33],[76,39,78,37],[76,44,78,42],[76,45,78,43],[77,6,79,4],[77,7,79,5],[77,8,79,6],[77,15,79,13,"error"],[77,20,79,18],[77,22,79,20],[78,8,80,6,"console"],[78,15,80,13],[78,16,80,14,"error"],[78,21,80,19],[78,22,80,20],[78,47,80,45],[78,49,80,47,"error"],[78,54,80,52],[78,55,80,53],[79,6,81,4],[80,4,82,2],[80,5,82,3],[81,4,84,2],[81,10,84,8,"completeOnboarding"],[81,28,84,26],[81,31,84,29],[81,37,84,29,"completeOnboarding"],[81,38,84,29],[81,43,84,41],[82,6,85,4],[82,12,85,10,"AsyncStorage"],[82,24,85,22],[82,25,85,22,"default"],[82,32,85,22],[82,33,85,23,"setItem"],[82,40,85,30],[82,41,85,31],[82,61,85,51],[82,63,85,53],[82,69,85,59],[82,70,85,60],[83,6,86,4,"setHasCompletedOnboarding"],[83,31,86,29],[83,32,86,30],[83,36,86,34],[83,37,86,35],[84,4,87,2],[84,5,87,3],[85,4,89,2],[85,10,89,8,"setPremium"],[85,20,89,18],[85,23,89,21],[85,29,89,28,"premium"],[85,36,89,44],[85,40,89,49],[86,6,90,4],[86,10,90,8],[87,8,91,6],[88,8,92,6,"console"],[88,15,92,13],[88,16,92,14,"log"],[88,19,92,17],[88,20,92,18],[88,41,92,39],[88,43,92,41,"premium"],[88,50,92,48],[88,51,92,49],[89,8,93,6,"setIsPremium"],[89,20,93,18],[89,21,93,19,"premium"],[89,28,93,26],[89,29,93,27],[90,8,94,6],[90,14,94,12,"AsyncStorage"],[90,26,94,24],[90,27,94,24,"default"],[90,34,94,24],[90,35,94,25,"setItem"],[90,42,94,32],[90,43,94,33],[90,54,94,44],[90,56,94,46,"premium"],[90,63,94,53],[90,64,94,54,"toString"],[90,72,94,62],[90,73,94,63],[90,74,94,64],[90,75,94,65],[91,8,95,6,"console"],[91,15,95,13],[91,16,95,14,"log"],[91,19,95,17],[91,20,95,18],[91,56,95,54],[91,57,95,55],[93,8,97,6],[94,8,98,6],[94,12,98,10,"userId"],[94,18,98,16],[94,20,98,18],[95,10,99,8],[95,16,99,14,"response"],[95,24,99,22],[95,27,99,25],[95,33,99,31,"fetch"],[95,38,99,36],[95,39,99,37],[95,42,99,40,"API_URL"],[95,49,99,47],[95,63,99,61,"userId"],[95,69,99,67],[95,92,99,90,"premium"],[95,99,99,97],[95,101,99,99],[95,103,99,101],[96,12,100,10,"method"],[96,18,100,16],[96,20,100,18],[97,10,101,8],[97,11,101,9],[97,12,101,10],[98,10,103,8],[98,14,103,12],[98,15,103,13,"response"],[98,23,103,21],[98,24,103,22,"ok"],[98,26,103,24],[98,28,103,26],[99,12,104,10,"console"],[99,19,104,17],[99,20,104,18,"error"],[99,25,104,23],[99,26,104,24],[99,57,104,55],[99,58,104,56],[100,10,105,8],[101,8,106,6],[102,6,107,4],[102,7,107,5],[102,8,107,6],[102,15,107,13,"error"],[102,20,107,18],[102,22,107,20],[103,8,108,6,"console"],[103,15,108,13],[103,16,108,14,"error"],[103,21,108,19],[103,22,108,20],[103,56,108,54],[103,58,108,56,"error"],[103,63,108,61],[103,64,108,62],[104,8,109,6],[105,6,110,4],[106,4,111,2],[106,5,111,3],[107,4,113,2],[107,24,114,4],[107,28,114,4,"_reactJsxDevRuntime"],[107,47,114,4],[107,48,114,4,"jsxDEV"],[107,54,114,4],[107,56,114,5,"UserContext"],[107,67,114,16],[107,68,114,17,"Provider"],[107,76,114,25],[108,6,115,6,"value"],[108,11,115,11],[108,13,115,13],[109,8,116,8,"userId"],[109,14,116,14],[110,8,117,8,"isPremium"],[110,17,117,17],[111,8,118,8,"isLoading"],[111,17,118,17],[112,8,119,8,"hasCompletedOnboarding"],[112,30,119,30],[113,8,120,8,"createUser"],[113,18,120,18],[114,8,121,8,"completeOnboarding"],[114,26,121,26],[115,8,122,8,"setPremium"],[115,18,122,18],[116,8,123,8,"refreshUser"],[117,6,124,6],[117,7,124,8],[118,6,124,8,"children"],[118,14,124,8],[118,16,126,7,"children"],[119,4,126,15],[120,6,126,15,"fileName"],[120,14,126,15],[120,16,126,15,"_jsxFileName"],[120,28,126,15],[121,6,126,15,"lineNumber"],[121,16,126,15],[122,6,126,15,"columnNumber"],[122,18,126,15],[123,4,126,15],[123,11,127,26],[123,12,127,27],[124,2,129,0],[125,2,131,7],[125,11,131,16,"useUser"],[125,18,131,23,"useUser"],[125,19,131,23],[125,21,131,26],[126,4,132,2],[126,10,132,8,"context"],[126,17,132,15],[126,20,132,18],[126,24,132,18,"useContext"],[126,30,132,28],[126,31,132,28,"useContext"],[126,41,132,28],[126,43,132,29,"UserContext"],[126,54,132,40],[126,55,132,41],[127,4,133,2],[127,8,133,6],[127,9,133,7,"context"],[127,16,133,14],[127,18,133,16],[128,6,134,4],[128,12,134,10],[128,16,134,14,"Error"],[128,21,134,19],[128,22,134,20],[128,64,134,62],[128,65,134,63],[129,4,135,2],[130,4,136,2],[130,11,136,9,"context"],[130,18,136,16],[131,2,137,0],[132,0,137,1],[132,3]],"functionMap":{"names":["<global>","UserProvider","useEffect$argument_0","initializeUser","createUser","refreshUser","completeOnboarding","setPremium","useUser"],"mappings":"AAA;OCmB;YCM;GDE;yBEE;GFuB;qBGE;GHc;sBIE;GJW;6BKE;GLG;qBME;GNsB;CDkB;OQE"},"hasCjsExports":false},"type":"js/module"}]}