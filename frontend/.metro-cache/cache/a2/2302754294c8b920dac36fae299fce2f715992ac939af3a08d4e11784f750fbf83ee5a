{"dependencies":[{"name":"expo/virtual/env","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"dgHc21cgR+buKc7O3/dChhD5JJk=","exportNames":["*"],"imports":1}},{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":78,"index":78}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":79},"end":{"line":2,"column":69,"index":148}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}},{"name":"react/jsx-dev-runtime","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"L9D70Z4hi4aGuui1ysja/oQ5ytI=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _jsxFileName = \"/app/frontend/src/contexts/UserContext.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.UserProvider = UserProvider;\n  exports.useUser = useUser;\n  var _expoVirtualEnv = require(_dependencyMap[0], \"expo/virtual/env\");\n  var _react = require(_dependencyMap[1], \"react\");\n  var _reactNativeAsyncStorageAsyncStorage = require(_dependencyMap[2], \"@react-native-async-storage/async-storage\");\n  var AsyncStorage = _interopDefault(_reactNativeAsyncStorageAsyncStorage);\n  var _reactJsxDevRuntime = require(_dependencyMap[3], \"react/jsx-dev-runtime\");\n  const API_URL = _expoVirtualEnv.env.EXPO_PUBLIC_BACKEND_URL;\n  const UserContext = /*#__PURE__*/(0, _react.createContext)(undefined);\n  function UserProvider({\n    children\n  }) {\n    _s();\n    const [userId, setUserId] = (0, _react.useState)(null);\n    const [isPremium, setIsPremium] = (0, _react.useState)(false);\n    const [isLoading, setIsLoading] = (0, _react.useState)(true);\n    const [hasCompletedOnboarding, setHasCompletedOnboarding] = (0, _react.useState)(false);\n    (0, _react.useEffect)(() => {\n      initializeUser();\n    }, []);\n    const initializeUser = async () => {\n      try {\n        const storedUserId = await AsyncStorage.default.getItem('userId');\n        const onboardingComplete = await AsyncStorage.default.getItem('onboardingComplete');\n        const storedPremium = await AsyncStorage.default.getItem('isPremium');\n\n        // Set premium from local storage first\n        if (storedPremium === 'true') {\n          setIsPremium(true);\n        }\n        if (storedUserId) {\n          setUserId(storedUserId);\n          setHasCompletedOnboarding(onboardingComplete === 'true');\n          await refreshUser(storedUserId);\n        } else {\n          await createUser();\n        }\n      } catch (error) {\n        console.error('Failed to initialize user:', error);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    const createUser = async () => {\n      try {\n        const response = await fetch(`${API_URL}/api/users`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          }\n        });\n        const data = await response.json();\n        await AsyncStorage.default.setItem('userId', data.userId);\n        setUserId(data.userId);\n        setIsPremium(data.isPremium);\n      } catch (error) {\n        console.error('Failed to create user:', error);\n      }\n    };\n    const refreshUser = async id => {\n      const targetId = id || userId;\n      if (!targetId) return;\n      try {\n        const response = await fetch(`${API_URL}/api/users/${targetId}`);\n        const data = await response.json();\n        setIsPremium(data.isPremium || false);\n      } catch (error) {\n        console.error('Failed to refresh user:', error);\n      }\n    };\n    const completeOnboarding = async () => {\n      await AsyncStorage.default.setItem('onboardingComplete', 'true');\n      setHasCompletedOnboarding(true);\n    };\n    const setPremium = async premium => {\n      try {\n        // Update locally first for immediate UI feedback\n        console.log('Setting premium to:', premium);\n        setIsPremium(premium);\n        await AsyncStorage.default.setItem('isPremium', premium.toString());\n        console.log('Premium state updated successfully');\n\n        // Then update on server if userId exists\n        if (userId) {\n          const response = await fetch(`${API_URL}/api/users/${userId}/premium?is_premium=${premium}`, {\n            method: 'PATCH'\n          });\n          if (!response.ok) {\n            console.error('Server error updating premium');\n          }\n        }\n      } catch (error) {\n        console.error('Failed to update premium status:', error);\n        // Keep the local state even if server fails\n      }\n    };\n    return /*#__PURE__*/(0, _reactJsxDevRuntime.jsxDEV)(UserContext.Provider, {\n      value: {\n        userId,\n        isPremium,\n        isLoading,\n        hasCompletedOnboarding,\n        createUser,\n        completeOnboarding,\n        setPremium,\n        refreshUser\n      },\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 5\n    }, this);\n  }\n  _s(UserProvider, \"zZKy6mqJf3ZeUf0UEeZ2/rS656Y=\");\n  _c = UserProvider;\n  function useUser() {\n    _s2();\n    const context = (0, _react.useContext)(UserContext);\n    if (!context) {\n      throw new Error('useUser must be used within UserProvider');\n    }\n    return context;\n  }\n  _s2(useUser, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\n  var _c;\n  $RefreshReg$(_c, \"UserProvider\");\n});","lineCount":142,"map":[[15,2,20,0,"exports"],[15,9,20,0],[15,10,20,0,"UserProvider"],[15,22,20,0],[15,25,20,0,"UserProvider"],[15,37,20,0],[16,2,131,0,"exports"],[16,9,131,0],[16,10,131,0,"useUser"],[16,17,131,0],[16,20,131,0,"useUser"],[16,27,131,0],[17,2,137,1],[17,6,137,1,"_expoVirtualEnv"],[17,21,137,1],[17,24,137,1,"require"],[17,31,137,1],[17,32,137,1,"_dependencyMap"],[17,46,137,1],[18,2,1,0],[18,6,1,0,"_react"],[18,12,1,0],[18,15,1,0,"require"],[18,22,1,0],[18,23,1,0,"_dependencyMap"],[18,37,1,0],[19,2,2,0],[19,6,2,0,"_reactNativeAsyncStorageAsyncStorage"],[19,42,2,0],[19,45,2,0,"require"],[19,52,2,0],[19,53,2,0,"_dependencyMap"],[19,67,2,0],[20,2,2,0],[20,6,2,0,"AsyncStorage"],[20,18,2,0],[20,21,2,0,"_interopDefault"],[20,36,2,0],[20,37,2,0,"_reactNativeAsyncStorageAsyncStorage"],[20,73,2,0],[21,2,2,69],[21,6,2,69,"_reactJsxDevRuntime"],[21,25,2,69],[21,28,2,69,"require"],[21,35,2,69],[21,36,2,69,"_dependencyMap"],[21,50,2,69],[22,2,5,0],[22,8,5,6,"API_URL"],[22,15,5,13],[22,18,5,13,"_expoVirtualEnv"],[22,33,5,13],[22,34,5,13,"env"],[22,37,5,13],[22,38,5,13,"EXPO_PUBLIC_BACKEND_URL"],[22,61,5,51],[23,2,18,0],[23,8,18,6,"UserContext"],[23,19,18,17],[23,35,18,20],[23,39,18,20,"createContext"],[23,45,18,33],[23,46,18,33,"createContext"],[23,59,18,33],[23,61,18,63,"undefined"],[23,70,18,72],[23,71,18,73],[24,2,20,7],[24,11,20,16,"UserProvider"],[24,23,20,28,"UserProvider"],[24,24,20,29],[25,4,20,31,"children"],[26,2,20,71],[26,3,20,72],[26,5,20,74],[27,4,20,74,"_s"],[27,6,20,74],[28,4,21,2],[28,10,21,8],[28,11,21,9,"userId"],[28,17,21,15],[28,19,21,17,"setUserId"],[28,28,21,26],[28,29,21,27],[28,32,21,30],[28,36,21,30,"useState"],[28,42,21,38],[28,43,21,38,"useState"],[28,51,21,38],[28,53,21,54],[28,57,21,58],[28,58,21,59],[29,4,22,2],[29,10,22,8],[29,11,22,9,"isPremium"],[29,20,22,18],[29,22,22,20,"setIsPremium"],[29,34,22,32],[29,35,22,33],[29,38,22,36],[29,42,22,36,"useState"],[29,48,22,44],[29,49,22,44,"useState"],[29,57,22,44],[29,59,22,45],[29,64,22,50],[29,65,22,51],[30,4,23,2],[30,10,23,8],[30,11,23,9,"isLoading"],[30,20,23,18],[30,22,23,20,"setIsLoading"],[30,34,23,32],[30,35,23,33],[30,38,23,36],[30,42,23,36,"useState"],[30,48,23,44],[30,49,23,44,"useState"],[30,57,23,44],[30,59,23,45],[30,63,23,49],[30,64,23,50],[31,4,24,2],[31,10,24,8],[31,11,24,9,"hasCompletedOnboarding"],[31,33,24,31],[31,35,24,33,"setHasCompletedOnboarding"],[31,60,24,58],[31,61,24,59],[31,64,24,62],[31,68,24,62,"useState"],[31,74,24,70],[31,75,24,70,"useState"],[31,83,24,70],[31,85,24,71],[31,90,24,76],[31,91,24,77],[32,4,26,2],[32,8,26,2,"useEffect"],[32,14,26,11],[32,15,26,11,"useEffect"],[32,24,26,11],[32,26,26,12],[32,32,26,18],[33,6,27,4,"initializeUser"],[33,20,27,18],[33,21,27,19],[33,22,27,20],[34,4,28,2],[34,5,28,3],[34,7,28,5],[34,9,28,7],[34,10,28,8],[35,4,30,2],[35,10,30,8,"initializeUser"],[35,24,30,22],[35,27,30,25],[35,33,30,25,"initializeUser"],[35,34,30,25],[35,39,30,37],[36,6,31,4],[36,10,31,8],[37,8,32,6],[37,14,32,12,"storedUserId"],[37,26,32,24],[37,29,32,27],[37,35,32,33,"AsyncStorage"],[37,47,32,45],[37,48,32,45,"default"],[37,55,32,45],[37,56,32,46,"getItem"],[37,63,32,53],[37,64,32,54],[37,72,32,62],[37,73,32,63],[38,8,33,6],[38,14,33,12,"onboardingComplete"],[38,32,33,30],[38,35,33,33],[38,41,33,39,"AsyncStorage"],[38,53,33,51],[38,54,33,51,"default"],[38,61,33,51],[38,62,33,52,"getItem"],[38,69,33,59],[38,70,33,60],[38,90,33,80],[38,91,33,81],[39,8,34,6],[39,14,34,12,"storedPremium"],[39,27,34,25],[39,30,34,28],[39,36,34,34,"AsyncStorage"],[39,48,34,46],[39,49,34,46,"default"],[39,56,34,46],[39,57,34,47,"getItem"],[39,64,34,54],[39,65,34,55],[39,76,34,66],[39,77,34,67],[41,8,36,6],[42,8,37,6],[42,12,37,10,"storedPremium"],[42,25,37,23],[42,30,37,28],[42,36,37,34],[42,38,37,36],[43,10,38,8,"setIsPremium"],[43,22,38,20],[43,23,38,21],[43,27,38,25],[43,28,38,26],[44,8,39,6],[45,8,41,6],[45,12,41,10,"storedUserId"],[45,24,41,22],[45,26,41,24],[46,10,42,8,"setUserId"],[46,19,42,17],[46,20,42,18,"storedUserId"],[46,32,42,30],[46,33,42,31],[47,10,43,8,"setHasCompletedOnboarding"],[47,35,43,33],[47,36,43,34,"onboardingComplete"],[47,54,43,52],[47,59,43,57],[47,65,43,63],[47,66,43,64],[48,10,44,8],[48,16,44,14,"refreshUser"],[48,27,44,25],[48,28,44,26,"storedUserId"],[48,40,44,38],[48,41,44,39],[49,8,45,6],[49,9,45,7],[49,15,45,13],[50,10,46,8],[50,16,46,14,"createUser"],[50,26,46,24],[50,27,46,25],[50,28,46,26],[51,8,47,6],[52,6,48,4],[52,7,48,5],[52,8,48,6],[52,15,48,13,"error"],[52,20,48,18],[52,22,48,20],[53,8,49,6,"console"],[53,15,49,13],[53,16,49,14,"error"],[53,21,49,19],[53,22,49,20],[53,50,49,48],[53,52,49,50,"error"],[53,57,49,55],[53,58,49,56],[54,6,50,4],[54,7,50,5],[54,16,50,14],[55,8,51,6,"setIsLoading"],[55,20,51,18],[55,21,51,19],[55,26,51,24],[55,27,51,25],[56,6,52,4],[57,4,53,2],[57,5,53,3],[58,4,55,2],[58,10,55,8,"createUser"],[58,20,55,18],[58,23,55,21],[58,29,55,21,"createUser"],[58,30,55,21],[58,35,55,33],[59,6,56,4],[59,10,56,8],[60,8,57,6],[60,14,57,12,"response"],[60,22,57,20],[60,25,57,23],[60,31,57,29,"fetch"],[60,36,57,34],[60,37,57,35],[60,40,57,38,"API_URL"],[60,47,57,45],[60,59,57,57],[60,61,57,59],[61,10,58,8,"method"],[61,16,58,14],[61,18,58,16],[61,24,58,22],[62,10,59,8,"headers"],[62,17,59,15],[62,19,59,17],[63,12,59,19],[63,26,59,33],[63,28,59,35],[64,10,59,54],[65,8,60,6],[65,9,60,7],[65,10,60,8],[66,8,62,6],[66,14,62,12,"data"],[66,18,62,16],[66,21,62,19],[66,27,62,25,"response"],[66,35,62,33],[66,36,62,34,"json"],[66,40,62,38],[66,41,62,39],[66,42,62,40],[67,8,63,6],[67,14,63,12,"AsyncStorage"],[67,26,63,24],[67,27,63,24,"default"],[67,34,63,24],[67,35,63,25,"setItem"],[67,42,63,32],[67,43,63,33],[67,51,63,41],[67,53,63,43,"data"],[67,57,63,47],[67,58,63,48,"userId"],[67,64,63,54],[67,65,63,55],[68,8,64,6,"setUserId"],[68,17,64,15],[68,18,64,16,"data"],[68,22,64,20],[68,23,64,21,"userId"],[68,29,64,27],[68,30,64,28],[69,8,65,6,"setIsPremium"],[69,20,65,18],[69,21,65,19,"data"],[69,25,65,23],[69,26,65,24,"isPremium"],[69,35,65,33],[69,36,65,34],[70,6,66,4],[70,7,66,5],[70,8,66,6],[70,15,66,13,"error"],[70,20,66,18],[70,22,66,20],[71,8,67,6,"console"],[71,15,67,13],[71,16,67,14,"error"],[71,21,67,19],[71,22,67,20],[71,46,67,44],[71,48,67,46,"error"],[71,53,67,51],[71,54,67,52],[72,6,68,4],[73,4,69,2],[73,5,69,3],[74,4,71,2],[74,10,71,8,"refreshUser"],[74,21,71,19],[74,24,71,22],[74,30,71,29,"id"],[74,32,71,40],[74,36,71,45],[75,6,72,4],[75,12,72,10,"targetId"],[75,20,72,18],[75,23,72,21,"id"],[75,25,72,23],[75,29,72,27,"userId"],[75,35,72,33],[76,6,73,4],[76,10,73,8],[76,11,73,9,"targetId"],[76,19,73,17],[76,21,73,19],[77,6,75,4],[77,10,75,8],[78,8,76,6],[78,14,76,12,"response"],[78,22,76,20],[78,25,76,23],[78,31,76,29,"fetch"],[78,36,76,34],[78,37,76,35],[78,40,76,38,"API_URL"],[78,47,76,45],[78,61,76,59,"targetId"],[78,69,76,67],[78,71,76,69],[78,72,76,70],[79,8,77,6],[79,14,77,12,"data"],[79,18,77,16],[79,21,77,19],[79,27,77,25,"response"],[79,35,77,33],[79,36,77,34,"json"],[79,40,77,38],[79,41,77,39],[79,42,77,40],[80,8,78,6,"setIsPremium"],[80,20,78,18],[80,21,78,19,"data"],[80,25,78,23],[80,26,78,24,"isPremium"],[80,35,78,33],[80,39,78,37],[80,44,78,42],[80,45,78,43],[81,6,79,4],[81,7,79,5],[81,8,79,6],[81,15,79,13,"error"],[81,20,79,18],[81,22,79,20],[82,8,80,6,"console"],[82,15,80,13],[82,16,80,14,"error"],[82,21,80,19],[82,22,80,20],[82,47,80,45],[82,49,80,47,"error"],[82,54,80,52],[82,55,80,53],[83,6,81,4],[84,4,82,2],[84,5,82,3],[85,4,84,2],[85,10,84,8,"completeOnboarding"],[85,28,84,26],[85,31,84,29],[85,37,84,29,"completeOnboarding"],[85,38,84,29],[85,43,84,41],[86,6,85,4],[86,12,85,10,"AsyncStorage"],[86,24,85,22],[86,25,85,22,"default"],[86,32,85,22],[86,33,85,23,"setItem"],[86,40,85,30],[86,41,85,31],[86,61,85,51],[86,63,85,53],[86,69,85,59],[86,70,85,60],[87,6,86,4,"setHasCompletedOnboarding"],[87,31,86,29],[87,32,86,30],[87,36,86,34],[87,37,86,35],[88,4,87,2],[88,5,87,3],[89,4,89,2],[89,10,89,8,"setPremium"],[89,20,89,18],[89,23,89,21],[89,29,89,28,"premium"],[89,36,89,44],[89,40,89,49],[90,6,90,4],[90,10,90,8],[91,8,91,6],[92,8,92,6,"console"],[92,15,92,13],[92,16,92,14,"log"],[92,19,92,17],[92,20,92,18],[92,41,92,39],[92,43,92,41,"premium"],[92,50,92,48],[92,51,92,49],[93,8,93,6,"setIsPremium"],[93,20,93,18],[93,21,93,19,"premium"],[93,28,93,26],[93,29,93,27],[94,8,94,6],[94,14,94,12,"AsyncStorage"],[94,26,94,24],[94,27,94,24,"default"],[94,34,94,24],[94,35,94,25,"setItem"],[94,42,94,32],[94,43,94,33],[94,54,94,44],[94,56,94,46,"premium"],[94,63,94,53],[94,64,94,54,"toString"],[94,72,94,62],[94,73,94,63],[94,74,94,64],[94,75,94,65],[95,8,95,6,"console"],[95,15,95,13],[95,16,95,14,"log"],[95,19,95,17],[95,20,95,18],[95,56,95,54],[95,57,95,55],[97,8,97,6],[98,8,98,6],[98,12,98,10,"userId"],[98,18,98,16],[98,20,98,18],[99,10,99,8],[99,16,99,14,"response"],[99,24,99,22],[99,27,99,25],[99,33,99,31,"fetch"],[99,38,99,36],[99,39,99,37],[99,42,99,40,"API_URL"],[99,49,99,47],[99,63,99,61,"userId"],[99,69,99,67],[99,92,99,90,"premium"],[99,99,99,97],[99,101,99,99],[99,103,99,101],[100,12,100,10,"method"],[100,18,100,16],[100,20,100,18],[101,10,101,8],[101,11,101,9],[101,12,101,10],[102,10,103,8],[102,14,103,12],[102,15,103,13,"response"],[102,23,103,21],[102,24,103,22,"ok"],[102,26,103,24],[102,28,103,26],[103,12,104,10,"console"],[103,19,104,17],[103,20,104,18,"error"],[103,25,104,23],[103,26,104,24],[103,57,104,55],[103,58,104,56],[104,10,105,8],[105,8,106,6],[106,6,107,4],[106,7,107,5],[106,8,107,6],[106,15,107,13,"error"],[106,20,107,18],[106,22,107,20],[107,8,108,6,"console"],[107,15,108,13],[107,16,108,14,"error"],[107,21,108,19],[107,22,108,20],[107,56,108,54],[107,58,108,56,"error"],[107,63,108,61],[107,64,108,62],[108,8,109,6],[109,6,110,4],[110,4,111,2],[110,5,111,3],[111,4,113,2],[111,24,114,4],[111,28,114,4,"_reactJsxDevRuntime"],[111,47,114,4],[111,48,114,4,"jsxDEV"],[111,54,114,4],[111,56,114,5,"UserContext"],[111,67,114,16],[111,68,114,17,"Provider"],[111,76,114,25],[112,6,115,6,"value"],[112,11,115,11],[112,13,115,13],[113,8,116,8,"userId"],[113,14,116,14],[114,8,117,8,"isPremium"],[114,17,117,17],[115,8,118,8,"isLoading"],[115,17,118,17],[116,8,119,8,"hasCompletedOnboarding"],[116,30,119,30],[117,8,120,8,"createUser"],[117,18,120,18],[118,8,121,8,"completeOnboarding"],[118,26,121,26],[119,8,122,8,"setPremium"],[119,18,122,18],[120,8,123,8,"refreshUser"],[121,6,124,6],[121,7,124,8],[122,6,124,8,"children"],[122,14,124,8],[122,16,126,7,"children"],[123,4,126,15],[124,6,126,15,"fileName"],[124,14,126,15],[124,16,126,15,"_jsxFileName"],[124,28,126,15],[125,6,126,15,"lineNumber"],[125,16,126,15],[126,6,126,15,"columnNumber"],[126,18,126,15],[127,4,126,15],[127,11,127,26],[127,12,127,27],[128,2,129,0],[129,2,129,1,"_s"],[129,4,129,1],[129,5,20,16,"UserProvider"],[129,17,20,28],[130,2,20,28,"_c"],[130,4,20,28],[130,7,20,16,"UserProvider"],[130,19,20,28],[131,2,131,7],[131,11,131,16,"useUser"],[131,18,131,23,"useUser"],[131,19,131,23],[131,21,131,26],[132,4,131,26,"_s2"],[132,7,131,26],[133,4,132,2],[133,10,132,8,"context"],[133,17,132,15],[133,20,132,18],[133,24,132,18,"useContext"],[133,30,132,28],[133,31,132,28,"useContext"],[133,41,132,28],[133,43,132,29,"UserContext"],[133,54,132,40],[133,55,132,41],[134,4,133,2],[134,8,133,6],[134,9,133,7,"context"],[134,16,133,14],[134,18,133,16],[135,6,134,4],[135,12,134,10],[135,16,134,14,"Error"],[135,21,134,19],[135,22,134,20],[135,64,134,62],[135,65,134,63],[136,4,135,2],[137,4,136,2],[137,11,136,9,"context"],[137,18,136,16],[138,2,137,0],[139,2,137,1,"_s2"],[139,5,137,1],[139,6,131,16,"useUser"],[139,13,131,23],[140,2,131,23],[140,6,131,23,"_c"],[140,8,131,23],[141,2,131,23,"$RefreshReg$"],[141,14,131,23],[141,15,131,23,"_c"],[141,17,131,23],[142,0,131,23],[142,3]],"functionMap":{"names":["<global>","UserProvider","useEffect$argument_0","initializeUser","createUser","refreshUser","completeOnboarding","setPremium","useUser"],"mappings":"AAA;OCmB;YCM;GDE;yBEE;GFuB;qBGE;GHc;sBIE;GJW;6BKE;GLG;qBME;GNsB;CDkB;OQE"},"hasCjsExports":false},"type":"js/module"}]}